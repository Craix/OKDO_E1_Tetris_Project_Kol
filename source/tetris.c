
#include "tetris.h"

struct Point blockPosition = {0, 0};

uint16_t texture[8][256];
uint8_t tetrisRotation, tetrisType, tetrisColor;
uint8_t g[gndSizeX][gndSizeY];
volatile int score = 0, bestScore = 0;
uint8_t tick, tickLimit;
char buffer[32];

bool gameMenu = true;

//64x32
const uint16_t tetris[] = {
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x4483, 0x4483, 0xB926, 0xB926, 0x68EC, 0x68EC, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x68EC, 0x68EC, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x4483, 0x4483, 0xB926, 0xB926, 0x68EC, 0x68EC, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x68EC, 0x68EC, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x68EC, 0x68EC, 0x4A69, 0x4A69, 0x13D5, 0x13D5, 0x7DE3, 0x7DE3, 0xB926, 0xB926, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x68EC, 0x68EC, 0x4A69, 0x4A69, 0x13D5, 0x13D5, 0x7DE3, 0x7DE3, 0xB926, 0xB926, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0xB926, 0xB926, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x4A69, 0x4A69, 0x13D5, 0x13D5, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0xB926, 0xB926, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x4A69, 0x4A69, 0x13D5, 0x13D5, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x13D5, 0x13D5, 0x4483, 0x4483, 0xB926, 0xB926, 0xE486, 0xE486, 0x5A05, 0x5A05, 0x13D5, 0x13D5, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x13D5, 0x13D5, 0x4483, 0x4483, 0xB926, 0xB926, 0xE486, 0xE486, 0x5A05, 0x5A05, 0x13D5, 0x13D5, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0xE486, 0xE486, 0x68EC, 0x68EC, 0x4483, 0x4483, 0xB926, 0xB926, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0xE486, 0xE486, 0x68EC, 0x68EC, 0x4483, 0x4483, 0xB926, 0xB926, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x7DE3, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xDA8E, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0xAA97, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x13D5, 0x13D5, 0x4483, 0x4483, 0xB926, 0xB926, 0x68EC, 0x68EC, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x13D5, 0x13D5, 0x4483, 0x4483, 0xB926, 0xB926, 0x68EC, 0x68EC, 0x5A05, 0x5A05, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x4483, 0x0000, 0x0000, 0x0000, 0x0000, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0xB926, 0x0000, 0x0000, 0x0000, 0x0000, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x68EC, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0xFFFF, 0xFFFF, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0xB596, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x8AE9, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xF58E, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x351D, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x4A69, 0x0000, 0x0000, 0x0000, 0x0000, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x5A05, 0x0000, 0x0000, 0x0000, 0x0000, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0xE486, 0x0000, 0x0000, 0x0000, 0x0000, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x13D5, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
};

const uint8_t model[7][4][5][5] =
{
	{
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,0,1,1,0},
			{0,0,1,0,0},
			{0,0,0,0,0}

		},
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,1,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,1,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,1,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,1,0,0,0},
			{0,1,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,1,0},
			{0,1,1,0,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,1,0,0,0},
			{0,1,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,0,1,1,0},
			{0,1,1,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,1,1,0,0},
			{0,1,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,0,0},
			{0,0,1,1,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,1,0},
			{0,0,1,1,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,1,1,0,0},
			{0,0,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,1,1,0,0},
			{0,1,1,0,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,0,0},
			{0,1,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,0,1,1,0},
			{0,0,1,1,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,1,0},
			{0,0,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,1,0},
			{0,1,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,1,1,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,1,0},
			{0,1,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,1,1,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,1,0,0,0},
			{0,1,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,1,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,1,0},
			{0,0,0,1,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,1,1,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		}
	},
	{
		{
			{0,0,0,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{0,1,1,1,1},
			{0,0,0,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,1,0,0},
			{0,0,0,0,0}
		},
		{
			{0,0,0,0,0},
			{0,0,0,0,0},
			{1,1,1,1,0},
			{0,0,0,0,0},
			{0,0,0,0,0}
		}
	}
};

//---------------------------------------------------------------------------------

void reset(void)
{
	tick = 0;
	tickLimit = 8;

	tetrisRotation = rand() % 4;
	tetrisType = rand() % 7;
	tetrisColor = (rand() % 7)+1;

	blockPosition.y = -2;
	blockPosition.x = gndSizeX / 2;
}

void splitImmage(uint16_t * input, uint16_t inputX, uint16_t inputY, uint16_t * output, uint16_t outputX, uint16_t outputY)
{
    int i = 0;

    for(int iy = 0; iy < (inputY / outputY); iy++)
    {
        for(int ix = 0;  ix < (inputX / outputX); ix++)
        {
            for(int oy = 0; oy < outputY; oy++)
            {
                for(int ox = 0; ox < outputX; ox++)
                {
                    output[i++] = input[((iy * outputY) + oy) * inputX + ((ix * outputX) + ox)];
                }
            }
        }
    }
}

void fill(uint8_t val)
{
	for (int i = 0; i < gndSizeX; i++)
	{
		for (int j = 0; j < gndSizeY; j++)
		{
			g[i][j] = val;
		}
	}
}

bool colisionDown(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if ((blockPosition.y + (-2 + j) == (gndSizeY-1)))
				{
					return true;
				}

				if(((blockPosition.x + (-2 + i)) >= 0) && ((blockPosition.y + 1) + (-2 + j) >= 0) && g[blockPosition.x + (-2 + i)][(blockPosition.y+1) + (-2 + j)] > 0)
				{
					return true;
				}
			}
		}
	}

	return false;
}

bool colisionUp(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if (blockPosition.y + (-2 + j) < 0)
				{
					return true;
				}
			}
		}
	}

	return false;
}

void addGround(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if (((blockPosition.x + (-2 + i)) >= 0) && (blockPosition.y + (-2 + j) >= 0))
				{
					g[blockPosition.x + i - 2][blockPosition.y + j - 2] = tetrisColor;
				}
			}
		}
	}
}

void checkForFull(void)
{
	int s = 0;
	int point = 0;

	for (int j = 0; j < gndSizeY; j++)
	{
		s = 0;
		for (int i = 0; i < gndSizeX; i++)
		{
			if(g[i][j] > 0)
			{
				s = s + 1;
			}
		}

		if (s == gndSizeX)
		{
			point++;
			for (int i = 0; i < gndSizeX; i++)
			{
				g[i][j] = 0;
			}

			for (int k = j; k > 0; k--)
			{
				for (int i = 0; i < gndSizeX; i++)
				{
					g[i][k] = g[i][k-1];
				}
			}
		}
	}

	for (int z = 0; z < point; z++)
	{
		for (int i = 0; i < gndSizeX; i++)
		{
			g[i][z] = 0;
		}
	}

	if(point > 0)
	{
		score = score + point;
		//
	}

}

bool rightAxis(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if (((blockPosition.x + 1) + (-2 + i)) == gndSizeX)
				{
					return false;
				}

				if(g[(blockPosition.x +1) + i-2][blockPosition.y+j-2] > 0)
				{
					return false;
				}
			}
		}
	}
	return true;
}

void right(void)
{
	if(rightAxis())
	{
		blockPosition.x++;
	}
}

bool leftAxis(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if(((blockPosition.x - 1) + (-2 + i)) < 0)
				{
					return false;
				}

				if(g[(blockPosition.x -1) + i-2][blockPosition.y+j-2] > 0)
				{
					return false;
				}
			}
		}
	}
	return true;
}

void left(void)
{
	if(leftAxis())
	{
		blockPosition.x--;
	}
}

bool controlRotate(void)
{
	uint8_t pr = tetrisRotation;
	pr++;
	if(pr > 3)
	{
		pr = 0;
	}

	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][pr][j][i])
			{
				if(g[blockPosition.x + (i-2)][(blockPosition.y+1) + (j-2)]>0)
				{
					return false;
				}
			}
		}
	}

	return true;
}

void rotate(void)
{
	if(controlRotate())
	{
		tetrisRotation++;
		if (tetrisRotation > 3)
		{
			tetrisRotation = 0;
		}

		//change color
		if(tetrisRotation == 0)
			colorStyle(true, false);
		if(tetrisRotation == 1)
			colorStyle(true, true);
		if(tetrisRotation == 2)
			colorStyle(false, false);
		if(tetrisRotation == 3)
			colorStyle(false, true);
	}
}

void drawElemnt(void)
{
	for (int i = 0; i < 5; i++)
	{
		for (int j = 0; j < 5; j++)
		{
			if (model[tetrisType][tetrisRotation][j][i])
			{
				if(blockPosition.x + (i-2) >= 0 && (blockPosition.y + (j-2)) >= 0)
				{
					LCD_Set_ImagePart(texture[tetrisColor], 16, 16, (blockPosition.x + (i-2)) * 16, (blockPosition.y + (j-2)) * 16);
				}
			}
		}
	}
}

void drawGround(void)
{
	for (int i = 0; i < gndSizeX; i++)
	{
		for (int j = 0; j < gndSizeY; j++)
		{
			if (g[i][j] > 0)
			{
				LCD_Set_ImagePart(texture[g[i][j]], 16, 16, i* 16, j * 16);
			}
		}
	}
}

//---------------------------------------------------------------------------------

void TetrisInit(SPI_Type *base)
{
	srand(time(NULL));

	gameMenu = true;
	score = 0;

	splitImmage((uint16_t*)tetris, 64, 32, (uint16_t*)texture, 16, 16);

	reset();
	fill(0);

	LCD_Init(base);

	LCD_Clear(rgb(0, 0, 255));
	LCD_GramRefresh();

}

void TetrisUpdate(float x, float y)
{
	if(!gameMenu)
	{
		if(x < -0.9){
			right();
		}

		if(x > 0.9){
			left();
		}

		//tick limit maniupulation
		if(y > 0.9){
			tickLimit = 0;
		}
		else{
			tickLimit = 8;
		}

		tick++;
		if(tick >= tickLimit)
		{
			if (colisionDown())
			{
				if (colisionUp())
				{
					//endgame
					gameMenu = true;
					fill(0);
				}
				else
				{
					addGround();
					checkForFull();
				}

				reset();
			}
			else
			{
				blockPosition.y++;
			}

			tick = 0;
		}
	}
}

void TetrisButton(void)
{
	if(gameMenu)
	{
		gameMenu = false;

		score = 0;

		if(score > bestScore){
			bestScore = score;
		}

		return;
	}

	if(!gameMenu)
	{
		rotate();
		return;
	}
}

void TetrisDraw(void)
{
	if(gameMenu)
	{
		LCD_Clear(_BLUE);

		LCD_Puts(4, 52, "[Tetris Simple Game]", _RED);
		LCD_Puts(16, 68, "[Press to Start]", _RED);

		sprintf(buffer, "[Best score: %04d]", bestScore);
		LCD_Puts(10, 84, buffer, _RED);

		sprintf(buffer, "[Your score: %04d]", score);
		LCD_Puts(10, 100, buffer, _RED);

		LCD_GramRefresh();
	}

	if(!gameMenu)
	{
		LCD_Clear(rgb(0, 0, 255));
		drawElemnt();
		drawGround();
		LCD_GramRefresh();
	}
}
